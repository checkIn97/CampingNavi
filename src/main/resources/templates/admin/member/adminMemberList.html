<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/html" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8"/>
    <title>회원 관리 페이지</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <style>
        body {
            display: flex;
            font-family: Arial, sans-serif; /* 폰트 설정 */
            line-height: 1.6; /* 줄 간격 */
        }
        .sidebar {
            width: 250px;
            height: 100vh;
            background-color: #343a40;
            padding: 20px;
        }
        .sidebar a {
            color: #ffffff;
            display: block;
            padding: 10px;
            text-decoration: none;
        }
        .sidebar a:hover {
            background-color: #495057;
        }
        .content {
            flex: 1;
            padding: 20px;
        }
        .page-index {
            padding: 20px;
        }
        .search-container {
            margin-bottom: 20px;
        }
        .table {
            width: 100%;
            margin-bottom: 20px;
        }
        .page-box {
            text-align: center;
        }
        .page-num {
            margin: 0 5px;
            cursor: pointer;
        }
        .page-num.active {
            font-weight: bold;
        }
        .icon {
            cursor: pointer;
        }
        .review-list-pop-back {
            background-color: #f8f9fa;
        }
        .popularPosts {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>

<body>
<div class="d-flex">
    <div class="sidebar">
        <a th:href="@{/admin/}"><h4 class="text-white">CampNavi Admin</h4></a>
        <a th:href="@{#}">데이터 관리</a>
        <a th:href="@{/admin/review/list}">리뷰 관리</a>
        <a th:href="@{/admin/member/list}">회원 관리</a>
    </div>
</div>
<div class="content">
    <h2 class="my-4">리뷰 리스트 관리자 페이지</h2>
    <div class="page-index">
        <!-- 검색 영역 -->
        <form method="get" th:action="@{/admin/review/list}">
            <div class="search-container form-inline">
                <select class="form-control mr-2" id="search" name="searchField">
                    <option value="username">아이디</option>
                    <option value="name">이름</option>
                </select>
                <input class="form-control mr-2" name="searchWord" type="text">
                <button class="btn btn-primary" type="submit">검색</button>
            </div>
        </form>

        <!-- 리스트 영역 -->
        <div id="list_area"></div>

        <!-- 페이지 영역 -->
        <div class="page-box">
            <img style="width:20px" class="icon width-rem1" id="prevBtn" src="/assets/images/icon/arrowL.png"/>
            <div id="page-area" class="page-num"></div>
            <img style="width:20px" class="icon width-rem1" id="nextBtn" src="/assets/images/icon/arrowR.png"/>
            <input type="hidden" id="hiddenTotal">
        </div>
    </div>
</div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    $(document).ready(function () {
        function memberList(page) {
            $.ajax({
                type: 'GET',
                url: '/admin/member/list/page',
                data: {
                    page : page,
                    size : 10
                },
                success: function (data) {
                    var memberArea = $("#list_area");
                    memberArea.empty();
                    var members = data.content;
                    members.forEach(function (member) {
                        memberArea.append('<span>아이디: ' + member.username + '</span>');
                        memberArea.append('<span>이름: ' + member.name + '</span>');
                        memberArea.append('<span th:if="' + member.sex + '==' +  '\'m\'' + '?' + '\'남자\'' + ':' + '\'여자\'' + '"></span>');
                        var formattedDate = moment(member.birth).format('YYYY-MM-DD HH:mm:ss');
                        memberArea.append('<p>' + formattedDate + '</p>');
                    });

                    var pagination = $("#page-area");
                    pagination.empty();
                    var totalPages = data.page.totalPages;
                    $("#hiddenTotal").val(totalPages);
                    var visiblePages = 3; // 표시할 페이지 버튼 수
                    var startPage = Math.max(0, Math.min(page - Math.floor(visiblePages / 2), totalPages - visiblePages));
                    var endPage = Math.min(totalPages, startPage + visiblePages);

                    // 페이지 버튼
                    for (var i = startPage; i < endPage; i++) {
                        pagination.append('<span style="cursor: pointer;" id="page" data-page="' + i + '">' + (i + 1) + '</span>');
                    }

                    currentPage = page;
                }
            });
        }

        $(document).on('click', '#page', function () {
            var page = $(this).data('page');
            memberList(page);
        });

        $('#prevBtn').click(function () {
            if (currentPage > 0) {
                memberList(currentPage - 1);
            }
        });

        $('#nextBtn').click(function () {
            if (currentPage < $('#hiddenTotal').val() -1) {
                memberList(currentPage + 1);
            }
        });

        memberList(0);
    });
</script>

</body>
</html>
