<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
    <link href="/assets/css/main.css" rel="stylesheet"/>
    <link href="/assets/css/bg/BG.css" rel="stylesheet"/>
    <title>CampNavi</title>
</head>

<body>
<article class="box" id="chatRoomBox">
    <div class="container" id="app">
        <div class="row">
            <!--            <div class="col-md-4 chatRoomBox" v-bind:key="item.roomId" v-for="item in chatrooms"-->
            <!--                 v-on:click="enterRoom(item.roomId)">-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item list-group-item-action">-->
            <!--                        {{item.name}}-->
            <!--                    </li>-->
            <!--                </ul>-->
            <!--            </div>-->
            <div class="col-md-4 chatRoomBox" v-bind:key="item.roomId" v-for="item in chatrooms"
                 v-on:click="enterRoom(item.roomId)">
                <ul class="list-group">
                    <li class="listChat">
                        <div class="buttonContain">
                            <h1 class="campingNameChat">산장이름 입력하는 부분</h1>
                            <div class="lengthContain" id="chatGradeMember">
                                <span class="chatGrade">
                                    <img alt="star-full" class="star" src="/assets/images/icon/star-full.png">
                                    <img alt="star-full" class="star" src="/assets/images/icon/star-full.png">
                                    <img alt="star-full" class="star" src="/assets/images/icon/star-full.png">
                                    <img alt="star-half" class="star" src="/assets/images/icon/star-half.png">
                                    <img alt="star-empty" class="star" src="/assets/images/icon/star-empty.png">
                                </span>
                                <div class="buttonContain">
                                    <img class="chatHumanIcon" src="/assets/images/icon/human.png">
                                    <span class="chatGradeNum">3.5점</span>
                                    <span class="chatReviewNum">000개의 후기</span>
                                </div>
                            </div>
                        </div>
                        <div class="lengthContain">
                            <div class="chatInfo">
                                <img class="calender" src="/assets/images/icon/calendar.png">
                                <div class="lengthContain">
                                    <span class="chat-day">2024.6.01-2024.6.03</span>
                                    <span class="chat-member">캠핑 참가 인원수 <span class="chat-member-num">4명</span></span>
                                </div>
                            </div>
                            <div class="chatPurpose">
                                <div class="chatPurposeSee">
                                    <img alt="dance" class="chatPurposeIcon" src="/assets/images/icon/dance.png">
                                    <span class="chatPurposeText">같이 놀아요!</span>
                                </div>
                                <div class="chatPurposeSee">
                                    <img alt="dogwith" class="chatPurposeIcon" src="/assets/images/icon/dogwith.png">
                                    <span class="chatPurposeText">애완동물과 함께해요!</span>
                                </div>
                                <div class="chatPurposeSee">
                                    <img alt="love" class="chatPurposeIcon" src="/assets/images/icon/love.png">
                                    <span class="chatPurposeText">만남을 원해요!</span>
                                </div>
                                <div class="chatPurposeSee">
                                    <img alt="parent" class="chatPurposeIcon" src="/assets/images/icon/parent.png">
                                    <span class="chatPurposeText">아이와 함께해요!</span>
                                </div>
                            </div>
                            <div class="buttonContain chatRoomNameBox">
                                <span class="chatRoomName">{{item.name}}</span>
                                <span class="chatRoomPN">12(채팅방 인원수)</span>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="input-group-append">
        <button class="mainBtn" id="createChatRoomBtn" type="button">채팅방 개설</button>
    </div>
</article>
<th:block th:insert="insert/footer.html"></th:block>

<!-- JavaScript -->
<script src="/webjars/vue/2.5.16/dist/vue.min.js"></script>
<script src="/webjars/axios/0.17.1/dist/axios.min.js"></script>
<script>
    var vm = new Vue({
        el: '#app',
        data: {
            room_name: '',
            chatrooms: []
        },
        created() {
            this.findAllRoom();
        },
        methods: {
            findAllRoom: function () {
                axios.get('/chat/rooms').then(response => {
                    this.chatrooms = response.data;
                });
            },
            createRoom: function () {
                if ("" === this.room_name) {
                    alert("방 제목을 입력해 주십시요.");
                    return;
                } else {
                    var params = new URLSearchParams();
                    params.append("name", this.room_name);
                    axios.post('/chat/room', params)
                        .then(
                            response => {
                                alert(response.data.name + "방 개설에 성공하였습니다.")
                                this.room_name = '';
                                this.findAllRoom();
                            }
                        )
                        .catch(response => {
                            alert("채팅방 개설에 실패하였습니다.");
                        });
                }
            },
            enterRoom: function (roomId) {
                var sender = prompt('대화명을 입력해 주세요.');
                if (sender != "") {
                    localStorage.setItem('wschat.sender', sender);
                    localStorage.setItem('wschat.roomId', roomId);
                    location.href = "/chat/room/enter/" + roomId;
                }
            }
        }
    });

    document.getElementById('createChatRoom').addEventListener('click', function () {
        location.href = "/chat/room/create";
    });

    /*배경 url 입력하는 스크립트*/
    window.onload = function () {
        var imageUrl = document.getElementById('chatCampingImg').src;
        var chatRoomBox = document.querySelector('.chatRoomBox');
        chatRoomBox.style.background = 'linear-gradient(to top, rgba(255, 255, 255, 1) 50%, rgba(255, 255, 255, 0) 111%, rgba(255, 255, 255, 0) 100%), url(' + imageUrl + ')';
        chatRoomBox.style.backgroundSize = 'cover';
        chatRoomBox.style.backgroundPosition = 'center';
    }
</script>

</body>
</html>