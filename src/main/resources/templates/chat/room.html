<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
    <link href="/assets/css/main.css" rel="stylesheet"/>
    <link href="/assets/css/bg/BG.css" rel="stylesheet"/>
    <title>CampNavi</title>
</head>
<body>
<th:block th:insert="insert/header.html"></th:block>
<input type="hidden" th:value="${member.name}" name="memberName"/>
<input type="hidden" th:value="${member.mseq}" name="memberMseq"/>
<input type="hidden" th:value="${comuCamp}" name="comuCamp"/>
<div id="app">
<article class="box centerBox" id="chatRoomBox">
    <div class="container" >
        <div class="row">
            <!--            <div class="col-md-4 chatRoomBox" v-bind:key="item.roomId" v-for="item in chatrooms"-->
            <!--                 v-on:click="enterRoom(item.roomId)">-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item list-group-item-action">-->
            <!--                        {{item.name}}-->
            <!--                    </li>-->
            <!--                </ul>-->
            <!--            </div>-->
            <div class="col-md-4 chatRoomBox" v-bind:key="item.chatRoom.roomId" v-for="item in chatrooms"
                 v-on:click="enterRoom(item.chatRoom.roomId)">
                <ul class="list-group">
                    <li class="listChat">
                        <div class="buttonContain">
                            <h1 class="campingNameChat">{{item.chatRoom.campName}}</h1>
                            <div class="lengthContain" id="chatGradeMember">
                                <span class="chatGrade">
                                    <span class="satisfaction" v-alt="item.score" v-title="item.score">
                                        <img v-if="item.score < 0.5" alt="star-empty" class="star" src="/assets/images/icon/star-empty.png">
                                        <img v-if="item.score >= 0.5 && item.score < 1.0" alt="star-empty" class="star" src="/assets/images/icon/star-half.png">
                                        <img v-if="item.score >= 1.0" alt="star-empty" class="star" src="/assets/images/icon/star-full.png">

                                        <img v-if="item.score < 1.5" alt="star-empty" class="star" src="/assets/images/icon/star-empty.png">
                                        <img v-if="item.score >= 1.5 && item.score < 2.0" alt="star-empty" class="star" src="/assets/images/icon/star-half.png">
                                        <img v-if="item.score >= 2.0" alt="star-empty" class="star" src="/assets/images/icon/star-full.png">

                                        <img v-if="item.score < 2.5" alt="star-empty" class="star" src="/assets/images/icon/star-empty.png">
                                        <img v-if="item.score >= 2.5 && item.score < 3.0" alt="star-empty" class="star" src="/assets/images/icon/star-half.png">
                                        <img v-if="item.score >= 3.0" alt="star-empty" class="star" src="/assets/images/icon/star-full.png">

                                        <img v-if="item.score < 3.5" alt="star-empty" class="star" src="/assets/images/icon/star-empty.png">
                                        <img v-if="item.score >= 3.5 && item.score < 4.0" alt="star-empty" class="star" src="/assets/images/icon/star-half.png">
                                        <img v-if="item.score >= 4.0" alt="star-empty" class="star" src="/assets/images/icon/star-full.png">

                                        <img v-if="item.score < 4.5" alt="star-empty" class="star" src="/assets/images/icon/star-empty.png">
                                        <img v-if="item.score >= 4.5 && item.score < 5.0" alt="star-empty" class="star" src="/assets/images/icon/star-half.png">
                                        <img v-if="item.score >= 5.0" alt="star-empty" class="star" src="/assets/images/icon/star-full.png">
                                    </span>
                                </span>
                                <div class="buttonContain">
                                    <img class="chatHumanIcon" src="/assets/images/icon/human.png">
                                    <span class="chatGradeNum">{{item.scoreView}}점</span>
                                    <span class="chatReviewNum">{{item.reviewCount}}개의 후기</span>
                                </div>
                            </div>
                        </div>
                        <div class="lengthContain">
                            <div class="chatInfo">
                                <img class="calender" src="/assets/images/icon/calendar.png">
                                <div class="lengthContain">
                                    <span class="chat-day">{{item.chatRoom.startDate}} - {{item.chatRoom.endDate}}</span>
                                    <span class="chat-member">캠핑 모집 인원수 <span
                                            class="chat-member-num">{{item.chatRoom.maxMem}}</span></span>
                                </div>
                            </div>
                            <div class="chatPurpose">
                                <div class="chatPurposeSee" v-for="purpose in item.chatRoom.purpose">
                                    <img alt="dance" class="chatPurposeIcon" src="/assets/images/icon/dance.png"
                                         v-if="purpose === '같이 놀아요!'">
                                    <img alt="dogwith" class="chatPurposeIcon" src="/assets/images/icon/dogwith.png"
                                         v-else-if="purpose === '애완동물과 함께해요!'">
                                    <img alt="love" class="chatPurposeIcon" src="/assets/images/icon/love.png"
                                         v-else-if="purpose === '만남을 원해요!'">
                                    <img alt="parent" class="chatPurposeIcon" src="/assets/images/icon/parent.png"
                                         v-else-if="purpose === '아이와 함께해요!'">
                                    <img alt="campingHuman" class="chatPurposeIcon"
                                         src="/assets/images/icon/campingHuman.png"
                                         v-else-if="purpose === '조용히 쉬어요!'">
                                    <span class="chatPurposeText">{{ purpose }}</span>
                                </div>
                            </div>
                            <div class="buttonContain chatRoomNameBox">
                                <span class="chatRoomName">{{item.chatRoom.name}}</span>
                                <!--채팅방 인원수-->
                                <span class="chatRoomPN">참여인원 : {{item.chatRoom.userCount}}</span>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

</article>

<div class="input-group-append">
    <button id="chatRoomSearchBtn" type="button">검색하기</button>
</div>
<div id="chatRoomSearch">
    <div class="nonPaddingBox">
        <div class="buttonContain" id="chatSearchName">
            <input class="form-control" id="chatSearchBar" placeholder="방 이름을 입력해주세요" v-model="search_word" type="text">
            <button class="chatRoomSearchBtn" id="chatSearchNameBtn" type="button" v-on:click="searchRoom()">검색</button>
        </div>
        <div class="buttonContain" id="chatRoomBtnZ">
            <button id="chatSearchPurposeListBtn" type="button">캠핑 목적</button>
            <div class="input-group-append">
                <button class="mainBtn" id="createChatRoomBtn" type="button">채팅방 개설</button>
            </div>
        </div>
        <div class="chatRoomPur">
            <input id="chatPurpose1" name="chatPurpose" type="checkbox" v-model="purpose" value="같이 놀아요!">
            <label for="chatPurpose1">
                <img alt="dance" class="chatPurposeIcon" src="/assets/images/icon/dance.png">
                같이 놀아요!
            </label>
            <input id="chatPurpose2" name="chatPurpose" type="checkbox" v-model="purpose" value="애완동물과 함께해요!">
            <label for="chatPurpose2">
                <img alt="dogwith" class="chatPurposeIcon" src="/assets/images/icon/dogwith.png">
                애완동물과 함께해요!
            </label>
            <input id="chatPurpose3" name="chatPurpose" type="checkbox" v-model="purpose" value="만남을 원해요!">
            <label for="chatPurpose3">
                <img alt="love" class="chatPurposeIcon" src="/assets/images/icon/love.png">
                만남을 원해요!
            </label>
            <input id="chatPurpose4" name="chatPurpose" type="checkbox" v-model="purpose" value="조용히 쉬어요!">
            <label for="chatPurpose4">
                <img alt="campingHuman" class="chatPurposeIcon" src="/assets/images/icon/campingHuman.png">
                조용히 쉬어요!
            </label>
            <input id="chatPurpose5" name="chatPurpose" type="checkbox" v-model="purpose" value="아이와 함께해요!">
            <label for="chatPurpose5">
                <img alt="parent" class="chatPurposeIcon" src="/assets/images/icon/parent.png">
                아이와 함께해요!
            </label>
        </div>
    </div>
</div>
</div>


<th:block th:insert="insert/footer.html"></th:block>

<!-- JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="/webjars/vue/2.5.16/dist/vue.min.js"></script>
<script src="/webjars/axios/0.17.1/dist/axios.min.js"></script>
<script>
    var memberName = $('input[name=memberName]').val();
    var memberMseq = $('input[name=memberMseq]').val();
    var comuCamp = $('input[name=comuCamp]').val();
</script>
<script>
    var vm = new Vue({
        el: '#app',
        data: {
            room_name: '',
            chatrooms: [],
            start_date: '',
            end_date: '',
            max_mem: '',
            purpose: [],
            memberName: memberName,
            camp_name: '',
            comuCamp: comuCamp,
            search_word: '',
            memberMseq: memberMseq

        },
        created() {
            this.findAllRoom();
        },
        methods: {
            findAllRoom: function () {
                var params = new URLSearchParams();
                params.append("campName", comuCamp);
                console.log(comuCamp + "rooms 로 전송");
                axios.get('/chat/rooms', { params: params }).then(response => {
                    this.chatrooms = response.data;

                });

            },

            createRoom: function () {
                if ("" === this.room_name) {
                    alert("방 제목을 입력해 주십시요.");
                    return;
                } else {
                    var params = new URLSearchParams();
                    params.append("name", this.room_name);
                    axios.post('/chat/room', params)
                        .then(
                            response => {
                                alert(response.data.name + "방 개설에 성공하였습니다.")
                                this.room_name = '';
                                this.findAllRoom();
                            }
                        )
                        .catch(response => {
                            alert("채팅방 개설에 실패하였습니다.");
                        });
                }
            },
            enterRoom: function (roomId) {
                var sender = prompt('대화명을 입력해 주세요.\n' + '대화명을 입력하지 않을 시 로그인하신정보( ' + memberName + ' ) 으로 입장합니다.');
                var mseq = memberMseq;
                if (sender === null) {
                    alert('입장이 취소되었습니다.');
                    return;
                }
                if (sender != "") {
                    localStorage.setItem('wschat.sender', sender);
                    localStorage.setItem('wschat.roomId', roomId);
                    localStorage.setItem('wschat.mseq', mseq)
                    location.href = "/chat/room/enter/" + roomId;
                } else {
                    sender = memberName;
                    localStorage.setItem('wschat.sender', sender);
                    localStorage.setItem('wschat.roomId', roomId);
                    localStorage.setItem('wschat.mseq', mseq)
                    location.href = "/chat/room/enter/" + roomId;
                }

            },
            searchRoom: function () {
                if ("" === this.search_word) {
                    alert("검색어를 입력해 주십시요.");
                    return;
                } else {
                    comuCamp = this.search_word
                    this.findAllRoom();
                }
            }

        }
    });

    document.getElementById('createChatRoomBtn').addEventListener('click', function () {
        location.href = "/chat/create";
    });

    /*    /!*배경 url 입력하는 스크립트*!/
        window.onload = function () {
            var imageUrl = document.getElementById('chatCampingImg').src;
            var chatRoomBox = document.querySelector('.chatRoomBox');
            chatRoomBox.style.background = 'to top, rgba(255, 255, 255, 1) 25%, rgba(255, 255, 255, 0.2) 100%, rgba(255, 255, 255, 0) 100%), url(' + imageUrl + ')';
            chatRoomBox.style.backgroundSize = 'cover';
            chatRoomBox.style.backgroundPosition = 'center';
        }*/

    document.getElementById('chatSearchPurposeListBtn').addEventListener('click', function () {
        var chatRoomPur = document.querySelector('.chatRoomPur');
        if (chatRoomPur.style.display === 'none' || chatRoomPur.style.display === '') {
            chatRoomPur.style.display = 'block'; // 보이도록 설정합니다.
        } else {
            chatRoomPur.style.display = 'none'; // 숨깁니다.
        }
    });

    document.getElementById('chatRoomSearchBtn').addEventListener('click', function () {
        var chatRoomSearch = document.getElementById('chatRoomSearch');
        if (chatRoomSearch.style.display === 'none' || chatRoomSearch.style.display === '') {
            chatRoomSearch.style.display = 'block'; // 보이도록 설정합니다.
        } else {
            chatRoomSearch.style.display = 'none'; // 숨깁니다.
        }
    });
</script>

</body>
</html>